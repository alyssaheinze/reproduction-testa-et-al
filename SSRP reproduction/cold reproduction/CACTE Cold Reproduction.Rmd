---
title: 'CACTE Cold Reproduction'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#Add packages here
library(dplyr)
```

## Reproducing table 1, rows 4 and 5

Table 1, rows 4 and 5 displays an estimated ATE, broken down by covariates and conditional on whether treatment is received by a male or female messenger. CACTE is therefore a conditional ACTE calculated by taking the difference of means between subjects assigned to receive the #MeToo message from either Jane or John and subjects assigned to receive no additional information. 

The CACTE for the treatment attributed to Jane (a woman): $CACTE_{Female} = E[Y|D = 1; C = 0; T = T_{Jane}]-E[Y|D = 1; C = 0; T = T_{Control}])$ and the CACTE for the treatment attributed to a man, John is $CACTE_{Male} = E[Y|D = 1; C = 0; T = T_{John}]-E[Y|D = 1; C = 0; T = T_{Control}])$.

Row 4 of table 1 has calculated the CACTE from the MTurk Sample on the DV "specific support for #MeToo" by coviariate, conditional upon receiving the message from a female messenger. 

Row 5 of table 1 has calculated the CACTE from the MTurk Sample on the DV "specific support for #MeToo" by coviariate, conditional upon receiving the message from a male messenger. 

Just like the ATE calculation, the outcome is a scale constructed from a principal components analysis of three items measured on 100-point scale tapping specific support for #MeToo movement. Should be: "dv_pca_metoo" as an outcome variable. 

We need to subset the data only to include those respondents from the MTurk sample. Then we need to only include those that avoided the treatment at first but then received the message either from a man or a woman. The CACTE will be calculated with this subset. 

```{r}
# Difference in means function from section

diff_means <- function(outcome, treatment){ 
  # Mean outcome for treated units
  Yt <- mean(outcome[treatment!="Control"], na.rm=TRUE)
  # Mean outcome for control units
  Yc <- mean(outcome[treatment=="Control"], na.rm=TRUE)
  # Difference in mean outcomes
  ate_hat <- Yt - Yc
  
  # Calculating number of observations
  N <- length(na.omit(outcome))
  
  # Preparing output
  results <- c(Yt, Yc, ate_hat, N)
  names(results) <- c("Mean Treated", "Mean Control", "Difference", "N")
  
  return(results)
}

#load data and run function
df <- load(file = "df_mtg.rda") # this is only the data for the mturk sample

#write a function to embed the difference in means function in cacte display
  #CACTE_female conditions: avoid01= 1, D_ch = female,
  #CACTE_male conditions: avoid01= 1, D_ch= Male
  #outcome = dv_pca_metoo

#Female Messenger

#Filter data by conditions. We want both female and control, so not male

df_fem <- df_mtg[ which(df_mtg$avoid01 ==1 & D_ch != "Male"),]

cacte_female <- diff_means(df_fem$dv_pca_metoo, df_fem$D_ch)


#Filter for male conditions. We want both male and control, so not female

df_male <- df_mtg[ which(df_mtg$avoid01 ==1 & D_ch != "Female"),]

cacte_male <- diff_means(df_male$dv_pca_metoo, df_male$D_ch)
  
cacte_overall <- rbind(cacte_female,cacte_male)
print(cacte_overall)
```

# Results seem correct so far. Next step is to repeat by the four covariates: Men, Women, Republicans, Democrats and modify diff-in-means function to display only the difference and the 95% confidence intervals.
